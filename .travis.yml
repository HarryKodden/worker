language: python
dist: xenial
python:
- '3.7'
env:
  global:
  - secure: nIScPdnBs+aDt1bGUiKX7nYHQ8AVExruc+MRh3FjOzp4kxqrhEasZGd390s9v219OAkDUh2l1VBLQnNF748eYi43ws+c8bJdra4cO4UcwZJct6bOJTub8hTFwjzX3Bs9uQQRqMPmc/7pmAU1F+DInwJBnf4eQppw9mrXUQhS3Xbd5lxm8fMoCdhFGX8ZuOBZ9AhmBNuaTvuoffkKXF1pdnrM4zmwkfjVE4BhIbhPuI9uSLcFMwyFmzQI0fIPjyM5ojFcJ5/sB7YJ6LZu1JXRKeOXVfjvcjW7B87kvs2Fv3ca1sCLpTVySBL/kWvyDb8ewjU+34X5ev49QZJuVE7ntvEjdLQtAfJb133keuP64vX7uaH7YY6tvADJL01TitJl/n0M0oasV8bE/9Q/rP9M+6zgRwMd6R1mjG+WPAH6F/ga0XpYEiUtw3pQii4c6q1E1jNVNBLx2TMPlsUOGQ93FgdxxkUshwNAMbMXqTJpOny9oDQexBJK7CHFvnOq6//BeaEz/XF5vUQerpjMAQ2Y41tykHjTKFWvL1JJ3bh93DJ0sTqbWpoTh2rnIRc5GZuBMAsqMEqIPKZygBtPI4T5n/Lltu58cCTNOSjxN0VtcbioudxMldGqpQszfCZyliJ5TKiWpVpsdbEC2Zl5UbU8Ijw8UILJ1dP1vjYMdnb9u6M=
  - secure: ccRo+ISk/Ym4VS3DFN6bDJd3ze3eN7YqIDhUYL1+nOblWbQaOqrV6o8cwdU8azkpxxfgXuvUC96O3cU23OS74/df4EG/0sYDwR/7uMwsuRKfhCQQBvUNqfIjlnhzC/6tDK6XRnUVTcrlZ/K8xWHnT0sc+bSMgyJogoRhwM34B6ALhigjcm3sVQxCIEWh1IuaFGTX3GCk85XDkERXSrs69AvKpU9z4F/zlZ/ysZS7XBaQFXP7T8KdZJ9zV5CtFdFHjMTrV2n3vXqEVjc340TKWY+bwPGFL6dGFfP5vdRnxi2NOqRrs36M6wqZHb8vISEuIMJMi/6LLE6Lp0aJRCfiQyLOSelwm9oI2/HCsxOr8QQSaEB6Uyim2g3YdaSGZoz0W/r3sV7bJXS6D6LfhM++QZCIkdBv7YdWqlVn9msQJ8RAGQkKehkClkhUhS6y2Wh915v5oZ5L7WpiwnCKo/EbFyGpIoid0ujqg428pxX5FfSNSU5XtgYLz6c2toQFbJqkSs9J2kPaQ6gNXikMjI0VwYHHHx+rL/ec1tC3TMJ+3NN9MDCcS7jYNg9fhMYAqTp1rBZ97SfduiEy4GVx/uamliXL35g0yXk5RJ4U/wRLj9gcP00W4VXLAP4Sb+s53XQ85kvL1Vu6MY1R2P2ei7c3JV6EUtvW/VO4euJVuthWJZI=
  - DOCKER_HUB_ORG=nebulaorchestrator
  - DOCKER_HUB_REPO=worker
  - GITHUB_PROJECT=worker
  - secure: JE+C+jjstVlbfwTyANMoro4vaVHf2NDA1cCVIlkHgi+VXOjTyeIoQwfy9VdaY18NKXI6XRCcpP66LueuQs9Ve9aiSWbZu2ca4g0uehB8DbGg9+Jj0F8Zibm6WCwPEi0ZD9GpmRZLr5xqs/F1vNuoKChMlgwM7ehFcxCOSdMtuSM+QFxPeoG2KZbQ/XwIdYu/ksXn+ZrqLdYHsjIF5VjfccXnVmklBc06Sw73n0YMqYMznbfwuMMVC+WAVYmvysMs90Cx7wiv5/hGSbBB+02U5J+22lHz2RKF++qme7RGJUiJw8dM9XDDJ3n0d574Ww+F2PA4rQ7V2FmOQU3/B4wMGsVm0M0aT+4R+1W+oC3XfCSAlppYXeJaP0KulEp6497S44ox6sgaqm7yE8eF8UmazKNMr66MTphBLaMW7tQS3LakarPHjuLwhVlOBEOD4tuCHqPVL+Br65rIQvuVXz0fsGs+2iYiNlPfYbklhqGB66gm/pw5ROwr/26VUMQc52x/cBI5hlJFJP0Co64wPC5x3EfhKpKfNKUcaeLsrwt9r/c9LtZy5ad+96X4qeZm1Dgzz6gQ77bZ3CrznXCMJY2LRtPShpcxiJjG1h29xN3GJPU2rjfJhehvprT7rfJHuFj2n1lkPirN3sR9NDuzK4JBTd5fJeLIUgQV9bLsVqQrjgw=
  - secure: 1nbU1Pqx8RIGV2GaBIRwD5hNqkY073LGowByd01X/earh8jDiOV9f1pdSyWkMfCd1Bmzc4JjwiKS4fS1+HmLpChj2UG6O16cOtSvosqnxRhm5iQ9CbJpbkub4Se7kHLvato1kRxyRnA/SNazMumB4Nzcf5ZMdpZqJ73lINVpZE53DTBGwXHP37dVbMz38OWj8SuhGyxskvpOwbE2CT3LoQFwv3ZWcqm9G3uharrT/OKS5O82BvOHoobMURmo0J98D3AIhgtcoVl9xcuvqwe+bgjY+/uBFbHr+APBUcYzHZau6eVUX8QbFPpbVr7gmDHM5+2Wf81QZ4KVDB9WLtwbZ3UCsb3HD6qFe4Ww0f00HHswf1aqbWJWQa3QMHUoa/p+7sB+usVzmajmuEo6t2tSZdIwkgysmdmbehTYVqp/vHGwnWAsdWzqLck6yTypNJ2k7Z8RB16chZ9nfEqdbl/MEpZTB50iJRxNe30ixjHn+SdwlRRrLl7ZGwD6VzzLd8q5YsN08/IQ1HA77Q4DEtG75xihcrYU8e6cUF4cXIho6Nip/B6+/qAdF6mnVYzBjISDLW91ne6MBoEtrIkRY4XplBxVadyfTiUSJGJKuR7OmQB3ZTuUeDwWeLRo86nnMdLr4FNnSOUoF2KEdeEyrQwwIm36b5oz+06H2MDhOABI2rI=
  - secure: Uhj2lD6EQnp+iP/35aHVXfka7ynoxac1tbtkoTYIFcQHpgAI//yqI8q8+t5wxue6R8VVPQuyBxJXy7k6AREmiKJFDc8yzNVbXVCcf+6XwoZLBu06ESHaWJi6iNZfQWOJgclJfvcSX1FFyPjkzMAN66BGT8hrSEfSWHfRodAlFT9C3rcysL5Jfm2C57td3XzqJ2HvHk7Vdps+GzwgMu/eEkjiH1q4vLO4EDNAT7Ug12XehR69uCsw245qNSRTZFRIZsKZgPuM7JLKAPFhfqAHWTBaWjim4i9Zu5/OkN+QIc62z5VCtxzz+UFvMw/ZcrPcsJPCohvUlwzA/0BgoJdZtuJjGHMu5rMXuEWmzT1ucC3v6C6DFdtmB9hzFASQgkyd1veGfZnkOHAo+Hl1dmq5h4hk0BzZG4fA73D3sXfgHjoFyYSSxOPjgVKJtI3bVhRGD+EpObfRZSTDc9iRcPoCkdfnPwUzuda8wvbJp2Qm81/6aIxNCGy5rVOlHA9KivkjBgr5LAPo8m2x4C2wUjBqBw7wPgmGoU0zljVd0z/CgDVU4OQ+ASe6suJCtJUoVOJGYwx8eXNPTtyqp0ljdDtmGhCAkmDlW+clmA8Ikq1oXp1yfYpvzGVkCoiD1fyaBLwNX3trKlPleZV+zgMdBDXS0tjZ4whO1C3Eb6DDstkhxmg=
install:
- pip install -r requirements.txt
- pip install codecov
script:
- sudo sh test/travis_ci_scripts/travis_ci_build_script.sh
- coverage run -m unittest
deploy:
  on:
    all_branches: true
  provider: script
  script: bash  test/travis_ci_scripts/deploy.sh
after_success:
- codecov
after_deploy:
- git config credential.helper "store --file=.git/credentials"
- echo "https://${GH_TOKEN}:@github.com" > .git/credentials
- git config --local user.name "${GITHUB_USER}"
- git config --local user.email "${GITHUB_USER_EMAIL}"
- docker run -e GITHUB_USER=nebula-orchestrator -e GITHUB_PROJECT=${GITHUB_PROJECT} -e CHANGELOG_GITHUB_TOKEN=${GH_TOKEN} -v `pwd`:/output naorlivne/github-changelog-generator-dockerized
- git add CHANGELOG.md
- git commit -m '[skip travis] build ${TRAVIS_BUILD_NUMBER} pushed - new version changelog'
- git push origin HEAD:master
